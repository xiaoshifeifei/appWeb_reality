/*! 
 Build based on gin-vue-admin 
 Time : 1725432472000 */
import{a as e,o as a,c as t,d as l,b as o,w as r,g as i,t as u,h as s,e as d,au as n,j as m,E as p,l as y}from"./087AC4D233B64EB0index.70d09b05.js";import{E as h,a as c}from"./087AC4D233B64EB0tab-pane.b806a7d2.js";/* empty css                               *//* empty css                                */import{a as B,E as v}from"./087AC4D233B64EB0form-item.cbb99123.js";/* empty css                              */import{E as C}from"./087AC4D233B64EB0radio.ce0b8ca9.js";/* empty css                               *//* empty css                            */import"./087AC4D233B64EB0checkbox.946614c0.js";/* empty css                                  */import{E as f,a as E}from"./087AC4D233B64EB0table-column.87522e19.js";/* empty css                                *//* empty css                               */import{g as A,d as j,c as I,u as D,a as b}from"./087AC4D233B64EB0authority.6f3dd0e4.js";import g from"./087AC4D233B64EB0menus.97fcd740.js";import w from"./087AC4D233B64EB0apis.20bb60d9.js";import k from"./087AC4D233B64EB0datas.02cec9f8.js";import{_}from"./087AC4D233B64EB0warningBar.fba111b1.js";import{E as x}from"./087AC4D233B64EB0index.cf7c943f.js";import"./087AC4D233B64EB0strings.1dceca3e.js";import"./087AC4D233B64EB0index.37b5a0cb.js";import"./087AC4D233B64EB0castArray.0e034210.js";import"./087AC4D233B64EB0_baseClone.a58dc1a4.js";import"./087AC4D233B64EB0_Uint8Array.b8c6af2c.js";import"./087AC4D233B64EB0_initCloneObject.073b420a.js";import"./087AC4D233B64EB0index.86c76e0e.js";import"./087AC4D233B64EB0isEqual.754d772a.js";import"./087AC4D233B64EB0arrays.2c626d3b.js";import"./087AC4D233B64EB0cloneDeep.17c0bdec.js";import"./087AC4D233B64EB0index.c39333f3.js";import"./087AC4D233B64EB0index.a54c8ec8.js";import"./087AC4D233B64EB0index.25218fc3.js";import"./087AC4D233B64EB0index.0adebf5a.js";import"./087AC4D233B64EB0debounce.034956aa.js";import"./087AC4D233B64EB0_baseIteratee.bc07217d.js";import"./087AC4D233B64EB0dialog.04c6d5cf.js";import"./087AC4D233B64EB0use-dialog.2e6e6d78.js";import"./087AC4D233B64EB0tree.2034c53a.js";import"./087AC4D233B64EB0token.9ae252be.js";import"./087AC4D233B64EB0index.8862a37e.js";import"./087AC4D233B64EB0authorityBtn.0366f024.js";import"./087AC4D233B64EB0api.081d701a.js";/* empty css                                       */const N={class:"authority"},V={class:"gva-table-box"},U={class:"gva-btn-list"},q={class:"flex justify-between items-center"},R={class:"text-lg"},z=Object.assign({name:"Authority"},{__name:"authority",setup(z){const P=e([{authorityId:0,authorityName:"根角色"}]),S=e(!1),F=e("add"),O=e({}),Q=e("新增角色"),T=e(!1),H=e(!1),K=e({}),L=e({authorityId:0,authorityName:"",parentId:0}),M=e({authorityId:[{required:!0,message:"请输入角色ID",trigger:"blur"},{validator:(e,a,t)=>/^[0-9]*[1-9][0-9]*$/.test(a)?t():t(new Error("请输入正整数")),trigger:"blur",message:"必须为正整数"}],authorityName:[{required:!0,message:"请输入角色名",trigger:"blur"}],parentId:[{required:!0,message:"请选择父角色",trigger:"blur"}]}),$=e([]),G=async()=>{const e=await A({page:1,pageSize:999});0===e.code&&($.value=e.data.list)};G();const J=(e,a)=>{O.value[e]=a},W=e(null),X=e(null),Y=e(null),Z=(e,a)=>{const t=[W,X,Y];a&&t[a].value.needConfirm&&(t[a].value.enterAndNext(),t[a].value.needConfirm=!1)},ee=e(null),ae=()=>{ee.value&&ee.value.resetFields(),L.value={authorityId:0,authorityName:"",parentId:0}},te=()=>{ae(),T.value=!1,H.value=!1},le=()=>{ee.value.validate((async e=>{if(e){switch(L.value.authorityId=Number(L.value.authorityId),F.value){case"add":0===(await b(L.value)).code&&(m({type:"success",message:"添加成功!"}),G(),te());break;case"edit":0===(await D(L.value)).code&&(m({type:"success",message:"添加成功!"}),G(),te());break;case"copy":{const e={authority:{authorityId:0,authorityName:"",datauthorityId:[],parentId:0},oldAuthorityId:0};e.authority.authorityId=L.value.authorityId,e.authority.authorityName=L.value.authorityName,e.authority.parentId=L.value.parentId,e.authority.dataAuthorityId=K.value.dataAuthorityId,e.oldAuthorityId=K.value.authorityId;0===(await I(e)).code&&(m({type:"success",message:"复制成功！"}),G())}}ae(),T.value=!1}}))},oe=()=>{P.value=[{authorityId:0,authorityName:"根角色"}],re($.value,P.value,!1)},re=(e,a,t)=>{e&&e.forEach((e=>{if(e.children&&e.children.length){const l={authorityId:e.authorityId,authorityName:e.authorityName,disabled:t||e.authorityId===L.value.authorityId,children:[]};re(e.children,l.children,t||e.authorityId===L.value.authorityId),a.push(l)}else{const l={authorityId:e.authorityId,authorityName:e.authorityName,disabled:t||e.authorityId===L.value.authorityId};a.push(l)}}))},ie=e=>{ae(),Q.value="新增角色",F.value="add",L.value.parentId=e,oe(),T.value=!0};return(e,A)=>{const I=p,D=f,b=E,z=C,H=B,ae=y,re=v,ue=x,se=h,de=c;return a(),t("div",N,[l(_,{title:"注：右上角头像下拉可切换角色"}),o("div",V,[o("div",U,[l(I,{type:"primary",icon:"plus",onClick:A[0]||(A[0]=e=>ie(0))},{default:r((()=>[i("新增角色")])),_:1})]),l(b,{data:$.value,"tree-props":{children:"children",hasChildren:"hasChildren"},"row-key":"authorityId",style:{width:"100%"}},{default:r((()=>[l(D,{label:"角色ID","min-width":"180",prop:"authorityId"}),l(D,{align:"left",label:"角色名称","min-width":"180",prop:"authorityName"}),l(D,{align:"left",label:"操作",width:"460"},{default:r((e=>[l(I,{icon:"setting",type:"primary",link:"",onClick:a=>{return t=e.row,S.value=!0,void(O.value=t);var t}},{default:r((()=>[i("设置权限")])),_:2},1032,["onClick"]),l(I,{icon:"plus",type:"primary",link:"",onClick:a=>ie(e.row.authorityId)},{default:r((()=>[i("新增子角色")])),_:2},1032,["onClick"]),l(I,{icon:"copy-document",type:"primary",link:"",onClick:a=>(e=>{oe(),Q.value="拷贝角色",F.value="copy";for(const a in L.value)L.value[a]=e[a];K.value=e,T.value=!0})(e.row)},{default:r((()=>[i("拷贝")])),_:2},1032,["onClick"]),l(I,{icon:"edit",type:"primary",link:"",onClick:a=>(e=>{oe(),Q.value="编辑角色",F.value="edit";for(const a in L.value)L.value[a]=e[a];oe(),ee.value&&ee.value.clearValidate(),T.value=!0})(e.row)},{default:r((()=>[i("编辑")])),_:2},1032,["onClick"]),l(I,{icon:"delete",type:"primary",link:"",onClick:a=>{return t=e.row,void n.confirm("此操作将永久删除该角色, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{0===(await j({authorityId:t.authorityId})).code&&(m({type:"success",message:"删除成功!"}),G())})).catch((()=>{m({type:"info",message:"已取消删除"})}));var t}},{default:r((()=>[i("删除")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])]),l(ue,{modelValue:T.value,"onUpdate:modelValue":A[4]||(A[4]=e=>T.value=e),"show-close":!1},{header:r((()=>[o("div",q,[o("span",R,u(Q.value),1),o("div",null,[l(I,{onClick:te},{default:r((()=>[i("取 消")])),_:1}),l(I,{type:"primary",onClick:le},{default:r((()=>[i("确 定")])),_:1})])])])),default:r((()=>[l(re,{ref_key:"authorityForm",ref:ee,model:L.value,rules:M.value,"label-width":"80px"},{default:r((()=>[l(H,{label:"父级角色",prop:"parentId"},{default:r((()=>[l(z,{modelValue:L.value.parentId,"onUpdate:modelValue":A[1]||(A[1]=e=>L.value.parentId=e),style:{width:"100%"},disabled:"add"===F.value,options:P.value,props:{checkStrictly:!0,label:"authorityName",value:"authorityId",disabled:"disabled",emitPath:!1},"show-all-levels":!1,filterable:""},null,8,["modelValue","disabled","options"])])),_:1}),l(H,{label:"角色ID",prop:"authorityId"},{default:r((()=>[l(ae,{modelValue:L.value.authorityId,"onUpdate:modelValue":A[2]||(A[2]=e=>L.value.authorityId=e),disabled:"edit"===F.value,autocomplete:"off",maxlength:"15"},null,8,["modelValue","disabled"])])),_:1}),l(H,{label:"角色姓名",prop:"authorityName"},{default:r((()=>[l(ae,{modelValue:L.value.authorityName,"onUpdate:modelValue":A[3]||(A[3]=e=>L.value.authorityName=e),autocomplete:"off"},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue"]),S.value?(a(),s(ue,{key:0,modelValue:S.value,"onUpdate:modelValue":A[5]||(A[5]=e=>S.value=e),"with-header":!1,size:"40%",title:"角色配置"},{default:r((()=>[l(de,{"before-leave":Z,type:"border-card"},{default:r((()=>[l(se,{label:"角色菜单"},{default:r((()=>[l(g,{ref_key:"menus",ref:W,row:O.value,onChangeRow:J},null,8,["row"])])),_:1}),l(se,{label:"角色api"},{default:r((()=>[l(w,{ref_key:"apis",ref:X,row:O.value,onChangeRow:J},null,8,["row"])])),_:1}),l(se,{label:"资源权限"},{default:r((()=>[l(k,{ref_key:"datas",ref:Y,authority:$.value,row:O.value,onChangeRow:J},null,8,["authority","row"])])),_:1})])),_:1})])),_:1},8,["modelValue"])):d("",!0)])}}});export{z as default};
