/*! 
 Build based on gin-vue-admin 
 Time : 1725432472000 */
import{o as e,h as a,w as l,g as t,j as o,E as i,d as s,_ as p,a as n,c as u,b as r,O as d,P as c,t as m,au as f,l as v,p as h,i as g}from"./087AC4D233B64EB0index.70d09b05.js";/* empty css                               *//* empty css                                *//* empty css                                   *//* empty css                            *//* empty css                               *//* empty css                                  *//* empty css                               */import{E as b,a as B}from"./087AC4D233B64EB0table-column.87522e19.js";import"./087AC4D233B64EB0checkbox.946614c0.js";/* empty css                                */import{a as y,E as w}from"./087AC4D233B64EB0form-item.cbb99123.js";/* empty css                               *//* empty css                              */import{g as A,i as C,e as _,a as E,d as x,f as D,s as j,b as V,u as I,c as k,h as P}from"./087AC4D233B64EB0api.081d701a.js";import{t as U}from"./087AC4D233B64EB0stringFun.647a78e9.js";import{_ as G}from"./087AC4D233B64EB0warningBar.fba111b1.js";/* empty css                               *//* empty css                                 */import{E as T}from"./087AC4D233B64EB0index.e10cda1e.js";import{E as S,a as z}from"./087AC4D233B64EB0index.46727ea4.js";import{E as O}from"./087AC4D233B64EB0index.7d3772ac.js";import{E as q}from"./087AC4D233B64EB0index.cf7c943f.js";import"./087AC4D233B64EB0index.86c76e0e.js";import"./087AC4D233B64EB0index.c39333f3.js";import"./087AC4D233B64EB0index.a54c8ec8.js";import"./087AC4D233B64EB0_baseIteratee.bc07217d.js";import"./087AC4D233B64EB0_Uint8Array.b8c6af2c.js";import"./087AC4D233B64EB0isEqual.754d772a.js";import"./087AC4D233B64EB0debounce.034956aa.js";import"./087AC4D233B64EB0index.0adebf5a.js";import"./087AC4D233B64EB0_initCloneObject.073b420a.js";import"./087AC4D233B64EB0castArray.0e034210.js";import"./087AC4D233B64EB0_baseClone.a58dc1a4.js";import"./087AC4D233B64EB0index.71ec1ce3.js";import"./087AC4D233B64EB0cloneDeep.17c0bdec.js";import"./087AC4D233B64EB0index.25218fc3.js";import"./087AC4D233B64EB0token.9ae252be.js";import"./087AC4D233B64EB0strings.1dceca3e.js";import"./087AC4D233B64EB0use-dialog.2e6e6d78.js";const N={__name:"exportExcel",props:{templateId:{type:String,required:!0},condition:{type:Object,default:()=>({})},limit:{type:Number,default:0},offset:{type:Number,default:0},order:{type:String,default:""}},setup(s){const p=s,n=async()=>{if(""===p.templateId)return void o.error("组件未设置模板ID");const e=JSON.parse(JSON.stringify(p.condition));p.limit&&(e.limit=p.limit),p.offset&&(e.offset=p.offset),p.order&&(e.order=p.order);const a=Object.entries(e).map((([e,a])=>"".concat(encodeURIComponent(e),"=").concat(encodeURIComponent(a)))).join("&"),l="".concat("/api","/sysExportTemplate/exportExcel?templateID=").concat(p.templateId).concat(a?"&"+a:"");window.open(l,"_blank")};return(o,s)=>{const p=i;return e(),a(p,{type:"primary",icon:"download",onClick:n},{default:l((()=>[t("导出")])),_:1})}}},F={__name:"exportTemplate",props:{templateId:{type:String,required:!0}},setup(s){const p=s,n=async()=>{if(""===p.templateId)return void o.error("组件未设置模板ID");const e="".concat("/api","/sysExportTemplate/exportTemplate?templateID=").concat(p.templateId);window.open(e,"_blank")};return(o,s)=>{const p=i;return e(),a(p,{type:"primary",icon:"download",onClick:n},{default:l((()=>[t("下载模板")])),_:1})}}},R={__name:"importExcel",props:{templateId:{type:String,required:!0}},emits:["on-success"],setup(p,{emit:n}){const u=p,r=n,d="".concat("/api","/sysExportTemplate/importExcel?templateID=").concat(u.templateId),c=e=>{0===e.code?(o.success("导入成功"),r("on-success")):o.error(e.msg)};return(o,p)=>{const n=i,u=T;return e(),a(u,{action:d,"show-file-list":!1,"on-success":c,multiple:!1},{default:l((()=>[s(n,{type:"primary",icon:"upload",class:"ml-3"},{default:l((()=>[t(" 导入 ")])),_:1})])),_:1})}}},J=e=>(h("data-v-f471870f"),e=e(),g(),e),K={class:"gva-search-box"},L={class:"gva-table-box"},M={class:"gva-btn-list"},Q={class:"gva-pagination"},Y={class:"flex justify-between items-center"},$=J((()=>r("span",{class:"text-lg"},"同步路由",-1))),H=J((()=>r("h4",null,[t("新增路由 "),r("span",{class:"text-xs text-gray-500 ml-2 font-normal"},"存在于当前路由中，但是不存在于api表")],-1))),W=J((()=>r("h4",null,[t("已删除路由 "),r("span",{class:"text-xs text-gray-500 ml-2 font-normal"},"已经不存在于当前项目的路由中，确定同步后会自动从apis表删除")],-1))),X=J((()=>r("h4",null,[t("忽略路由 "),r("span",{class:"text-xs text-gray-500 ml-2 font-normal"},"忽略路由不参与api同步，常见为不需要进行鉴权行为的路由")],-1))),Z={class:"flex justify-between items-center"},ee={class:"text-lg"},ae=p(Object.assign({name:"Api"},{__name:"api",setup(p){const h=e=>{const a=J.value.filter((a=>a.value===e))[0];return a&&"".concat(a.label)},g=n([]),T=n({path:"",apiGroup:"",method:"",description:""}),J=n([{value:"POST",label:"创建",type:"success"},{value:"GET",label:"查看",type:""},{value:"PUT",label:"更新",type:"warning"},{value:"DELETE",label:"删除",type:"danger"}]),ae=n(""),le=n({path:[{required:!0,message:"请输入api路径",trigger:"blur"}],apiGroup:[{required:!0,message:"请输入组名称",trigger:"blur"}],method:[{required:!0,message:"请选择请求方式",trigger:"blur"}],description:[{required:!0,message:"请输入api介绍",trigger:"blur"}]}),te=n(1),oe=n(0),ie=n(10),se=n([]),pe=n({}),ne=n([]),ue=n({}),re=async()=>{const e=await A();if(0===e.code){const a=e.data.groups;ne.value=a.map((e=>({label:e,value:e}))),ue.value=e.data.apiGroupMap}},de=async(e,a)=>{const l=await C({path:e.path,method:e.method,flag:a});if(0===l.code){if(o({type:"success",message:l.msg}),a)return _e.value.newApis=_e.value.newApis.filter((a=>!(a.path===e.path&&a.method===e.method))),void _e.value.ignoreApis.push(e);_e.value.ignoreApis=_e.value.ignoreApis.filter((a=>!(a.path===e.path&&a.method===e.method))),_e.value.newApis.push(e)}},ce=()=>{Ee.value=!1},me=n(!1),fe=async()=>{me.value=!0;const e=await _(_e.value);me.value=!1,0===e.code&&(o({type:"success",message:e.msg}),Ee.value=!1,ye())},ve=()=>{pe.value={}},he=()=>{te.value=1,ie.value=10,ye()},ge=e=>{ie.value=e,ye()},be=e=>{te.value=e,ye()},Be=({prop:e,order:a})=>{e&&("ID"===e&&(e="id"),pe.value.orderKey=U(e),pe.value.desc="descending"===a),ye()},ye=async()=>{const e=await E({page:te.value,pageSize:ie.value,...pe.value});0===e.code&&(se.value=e.data.list,oe.value=e.data.total,te.value=e.data.page,ie.value=e.data.pageSize)};ye(),re();const we=e=>{g.value=e},Ae=async()=>{f.confirm("确定要删除吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{const e=g.value.map((e=>e.ID)),a=await x({ids:e});0===a.code&&(o({type:"success",message:a.msg}),se.value.length===e.length&&te.value>1&&te.value--,ye())}))},Ce=async()=>{f.confirm("确定要刷新缓存吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{const e=await D();0===e.code&&o({type:"success",message:e.msg})}))},_e=n({newApis:[],deleteApis:[],ignoreApis:[]}),Ee=n(!1),xe=async()=>{const e=await j();0===e.code&&(e.data.newApis.forEach((e=>{e.apiGroup=ue.value[e.path.split("/")[1]],console.log(ue.value)})),_e.value=e.data,Ee.value=!0)},De=n(null),je=n("新增Api"),Ve=n(!1),Ie=e=>{switch(e){case"addApi":je.value="新增Api";break;case"edit":je.value="编辑Api"}ae.value=e,Ve.value=!0},ke=()=>{De.value.resetFields(),T.value={path:"",apiGroup:"",method:"",description:""},Ve.value=!1},Pe=async()=>{De.value.validate((async e=>{if(e)switch(ae.value){case"addApi":0===(await k(T.value)).code&&o({type:"success",message:"添加成功",showClose:!0}),ye(),re(),ke();break;case"edit":0===(await I(T.value)).code&&o({type:"success",message:"编辑成功",showClose:!0}),ye(),ke();break;default:o({type:"error",message:"未知操作",showClose:!0})}}))};return(p,n)=>{const A=v,C=y,_=S,E=z,x=i,D=w,j=b,I=B,k=O,U=q;return e(),u("div",null,[r("div",K,[s(D,{ref:"searchForm",inline:!0,model:pe.value},{default:l((()=>[s(C,{label:"路径"},{default:l((()=>[s(A,{modelValue:pe.value.path,"onUpdate:modelValue":n[0]||(n[0]=e=>pe.value.path=e),placeholder:"路径"},null,8,["modelValue"])])),_:1}),s(C,{label:"描述"},{default:l((()=>[s(A,{modelValue:pe.value.description,"onUpdate:modelValue":n[1]||(n[1]=e=>pe.value.description=e),placeholder:"描述"},null,8,["modelValue"])])),_:1}),s(C,{label:"API分组"},{default:l((()=>[s(E,{modelValue:pe.value.apiGroup,"onUpdate:modelValue":n[2]||(n[2]=e=>pe.value.apiGroup=e),clearable:"",placeholder:"请选择"},{default:l((()=>[(e(!0),u(d,null,c(ne.value,(l=>(e(),a(_,{key:l.value,label:l.label,value:l.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),s(C,{label:"请求"},{default:l((()=>[s(E,{modelValue:pe.value.method,"onUpdate:modelValue":n[3]||(n[3]=e=>pe.value.method=e),clearable:"",placeholder:"请选择"},{default:l((()=>[(e(!0),u(d,null,c(J.value,(l=>(e(),a(_,{key:l.value,label:"".concat(l.label,"(").concat(l.value,")"),value:l.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),s(C,null,{default:l((()=>[s(x,{type:"primary",icon:"search",onClick:he},{default:l((()=>[t(" 查询 ")])),_:1}),s(x,{icon:"refresh",onClick:ve},{default:l((()=>[t(" 重置 ")])),_:1})])),_:1})])),_:1},8,["model"])]),r("div",L,[r("div",M,[s(x,{type:"primary",icon:"plus",onClick:n[4]||(n[4]=e=>Ie("addApi"))},{default:l((()=>[t(" 新增 ")])),_:1}),s(x,{icon:"delete",disabled:!g.value.length,onClick:Ae},{default:l((()=>[t(" 删除 ")])),_:1},8,["disabled"]),s(x,{icon:"Refresh",onClick:Ce},{default:l((()=>[t(" 刷新缓存 ")])),_:1}),s(x,{icon:"Compass",onClick:xe},{default:l((()=>[t(" 同步API ")])),_:1}),s(F,{"template-id":"api"}),s(N,{"template-id":"api",limit:9999}),s(R,{"template-id":"api",onOnSuccess:ye})]),s(I,{data:se.value,onSortChange:Be,onSelectionChange:we},{default:l((()=>[s(j,{type:"selection",width:"55"}),s(j,{align:"left",label:"id","min-width":"60",prop:"ID",sortable:"custom"}),s(j,{align:"left",label:"API路径","min-width":"150",prop:"path",sortable:"custom"}),s(j,{align:"left",label:"API分组","min-width":"150",prop:"apiGroup",sortable:"custom"}),s(j,{align:"left",label:"API简介","min-width":"150",prop:"description",sortable:"custom"}),s(j,{align:"left",label:"请求","min-width":"150",prop:"method",sortable:"custom"},{default:l((e=>[r("div",null,m(e.row.method)+" / "+m(h(e.row.method)),1)])),_:1}),s(j,{align:"left",fixed:"right",label:"操作",width:"200"},{default:l((e=>[s(x,{icon:"edit",type:"primary",link:"",onClick:a=>(async e=>{const a=await V({id:e.ID});T.value=a.data.api,Ie("edit")})(e.row)},{default:l((()=>[t(" 编辑 ")])),_:2},1032,["onClick"]),s(x,{icon:"delete",type:"primary",link:"",onClick:a=>(async e=>{f.confirm("此操作将永久删除所有角色下该api, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{0===(await P(e)).code&&(o({type:"success",message:"删除成功!"}),1===se.value.length&&te.value>1&&te.value--,ye(),re())}))})(e.row)},{default:l((()=>[t(" 删除 ")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"]),r("div",Q,[s(k,{"current-page":te.value,"page-size":ie.value,"page-sizes":[10,30,50,100],total:oe.value,layout:"total, sizes, prev, pager, next, jumper",onCurrentChange:be,onSizeChange:ge},null,8,["current-page","page-size","total"])])]),s(U,{modelValue:Ee.value,"onUpdate:modelValue":n[5]||(n[5]=e=>Ee.value=e),size:"80%","before-close":ce,"show-close":!1},{header:l((()=>[r("div",Y,[$,r("div",null,[s(x,{onClick:ce},{default:l((()=>[t(" 取 消 ")])),_:1}),s(x,{type:"primary",loading:me.value,onClick:fe},{default:l((()=>[t(" 确 定 ")])),_:1},8,["loading"])])])])),default:l((()=>[s(G,{title:"同步API，不输入路由分组将不会被自动同步"}),H,s(I,{data:_e.value.newApis},{default:l((()=>[s(j,{align:"left",label:"API路径","min-width":"150",prop:"path"}),s(j,{align:"left",label:"API分组","min-width":"150",prop:"apiGroup"},{default:l((({row:t})=>[s(E,{modelValue:t.apiGroup,"onUpdate:modelValue":e=>t.apiGroup=e,placeholder:"请选择或新增","allow-create":"",filterable:"","default-first-option":""},{default:l((()=>[(e(!0),u(d,null,c(ne.value,(l=>(e(),a(_,{key:l.value,label:l.label,value:l.value},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue"])])),_:1}),s(j,{align:"left",label:"API简介","min-width":"150",prop:"description"},{default:l((({row:e})=>[s(A,{modelValue:e.description,"onUpdate:modelValue":a=>e.description=a,autocomplete:"off"},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),s(j,{align:"left",label:"请求","min-width":"150",prop:"method"},{default:l((e=>[r("div",null,m(e.row.method)+" / "+m(h(e.row.method)),1)])),_:1}),s(j,{label:"操作","min-width":"150",fixed:"right"},{default:l((({row:e})=>[s(x,{type:"primary",text:"",onClick:a=>de(e,!0)},{default:l((()=>[t(" 忽略 ")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"]),W,s(I,{data:_e.value.deleteApis},{default:l((()=>[s(j,{align:"left",label:"API路径","min-width":"150",prop:"path"}),s(j,{align:"left",label:"API分组","min-width":"150",prop:"apiGroup"}),s(j,{align:"left",label:"API简介","min-width":"150",prop:"description"}),s(j,{align:"left",label:"请求","min-width":"150",prop:"method"},{default:l((e=>[r("div",null,m(e.row.method)+" / "+m(h(e.row.method)),1)])),_:1})])),_:1},8,["data"]),X,s(I,{data:_e.value.ignoreApis},{default:l((()=>[s(j,{align:"left",label:"API路径","min-width":"150",prop:"path"}),s(j,{align:"left",label:"API分组","min-width":"150",prop:"apiGroup"}),s(j,{align:"left",label:"API简介","min-width":"150",prop:"description"}),s(j,{align:"left",label:"请求","min-width":"150",prop:"method"},{default:l((e=>[r("div",null,m(e.row.method)+" / "+m(h(e.row.method)),1)])),_:1}),s(j,{label:"操作","min-width":"150",fixed:"right"},{default:l((({row:e})=>[s(x,{type:"primary",text:"",onClick:a=>de(e,!1)},{default:l((()=>[t(" 取消忽略 ")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])])),_:1},8,["modelValue"]),s(U,{modelValue:Ve.value,"onUpdate:modelValue":n[10]||(n[10]=e=>Ve.value=e),size:"60%","before-close":ke,"show-close":!1},{header:l((()=>[r("div",Z,[r("span",ee,m(je.value),1),r("div",null,[s(x,{onClick:ke},{default:l((()=>[t(" 取 消 ")])),_:1}),s(x,{type:"primary",onClick:Pe},{default:l((()=>[t(" 确 定 ")])),_:1})])])])),default:l((()=>[s(G,{title:"新增API，需要在角色管理内配置权限才可使用"}),s(D,{ref_key:"apiForm",ref:De,model:T.value,rules:le.value,"label-width":"80px"},{default:l((()=>[s(C,{label:"路径",prop:"path"},{default:l((()=>[s(A,{modelValue:T.value.path,"onUpdate:modelValue":n[6]||(n[6]=e=>T.value.path=e),autocomplete:"off"},null,8,["modelValue"])])),_:1}),s(C,{label:"请求",prop:"method"},{default:l((()=>[s(E,{modelValue:T.value.method,"onUpdate:modelValue":n[7]||(n[7]=e=>T.value.method=e),placeholder:"请选择",style:{width:"100%"}},{default:l((()=>[(e(!0),u(d,null,c(J.value,(l=>(e(),a(_,{key:l.value,label:"".concat(l.label,"(").concat(l.value,")"),value:l.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),s(C,{label:"api分组",prop:"apiGroup"},{default:l((()=>[s(E,{modelValue:T.value.apiGroup,"onUpdate:modelValue":n[8]||(n[8]=e=>T.value.apiGroup=e),placeholder:"请选择或新增","allow-create":"",filterable:"","default-first-option":""},{default:l((()=>[(e(!0),u(d,null,c(ne.value,(l=>(e(),a(_,{key:l.value,label:l.label,value:l.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),s(C,{label:"api简介",prop:"description"},{default:l((()=>[s(A,{modelValue:T.value.description,"onUpdate:modelValue":n[9]||(n[9]=e=>T.value.description=e),autocomplete:"off"},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue"])])}}}),[["__scopeId","data-v-f471870f"]]);export{ae as default};
