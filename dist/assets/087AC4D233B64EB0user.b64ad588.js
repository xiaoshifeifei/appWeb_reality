/*! 
 Build based on gin-vue-admin 
 Time : 1725432472000 */
import{a as e,T as a,o as l,c as t,d as i,b as o,w as s,g as r,h as u,e as d,dI as n,au as m,dJ as p,j as c,dK as B,dL as g,dM as v,aj as h,dN as y,E as C,l as D}from"./087AC4D233B64EB0index.70d09b05.js";/* empty css                               *//* empty css                                */import{a as E,E as f}from"./087AC4D233B64EB0form-item.cbb99123.js";/* empty css                              *//* empty css                                   *//* empty css                            *//* empty css                               *//* empty css                                  *//* empty css                               */import{E as b,a as j}from"./087AC4D233B64EB0table-column.87522e19.js";import"./087AC4D233B64EB0checkbox.946614c0.js";/* empty css                                */import{E as w}from"./087AC4D233B64EB0switch.4d3b2bd4.js";import{E as A}from"./087AC4D233B64EB0radio.ce0b8ca9.js";/* empty css                               */import{g as _}from"./087AC4D233B64EB0authority.6f3dd0e4.js";import{C as I}from"./087AC4D233B64EB0index.ffca45ba.js";import{_ as V}from"./087AC4D233B64EB0warningBar.fba111b1.js";import{_ as x}from"./087AC4D233B64EB0selectImage.4892b84a.js";import{E as k}from"./087AC4D233B64EB0index.7d3772ac.js";import{E as N}from"./087AC4D233B64EB0index.cf7c943f.js";import"./087AC4D233B64EB0castArray.0e034210.js";import"./087AC4D233B64EB0_baseClone.a58dc1a4.js";import"./087AC4D233B64EB0_Uint8Array.b8c6af2c.js";import"./087AC4D233B64EB0_initCloneObject.073b420a.js";import"./087AC4D233B64EB0index.86c76e0e.js";import"./087AC4D233B64EB0index.c39333f3.js";import"./087AC4D233B64EB0index.a54c8ec8.js";import"./087AC4D233B64EB0_baseIteratee.bc07217d.js";import"./087AC4D233B64EB0isEqual.754d772a.js";import"./087AC4D233B64EB0debounce.034956aa.js";import"./087AC4D233B64EB0index.0adebf5a.js";import"./087AC4D233B64EB0strings.1dceca3e.js";import"./087AC4D233B64EB0arrays.2c626d3b.js";import"./087AC4D233B64EB0cloneDeep.17c0bdec.js";import"./087AC4D233B64EB0index.25218fc3.js";/* empty css                                     *//* empty css                                                                              */import"./087AC4D233B64EB0index.445cc723.js";import"./087AC4D233B64EB0position.3aaa8bf0.js";import"./087AC4D233B64EB0image.381f4010.js";import"./087AC4D233B64EB0common.27d965e2.js";/* empty css                               *//* empty css                                 *//* empty css                                                                              */import"./087AC4D233B64EB0index.e10cda1e.js";import"./087AC4D233B64EB0index.71ec1ce3.js";import"./087AC4D233B64EB0index.46727ea4.js";import"./087AC4D233B64EB0token.9ae252be.js";import"./087AC4D233B64EB0use-dialog.2e6e6d78.js";const U={class:"gva-table-box"},z={class:"gva-btn-list"},S={class:"gva-pagination"},T={class:"flex justify-between items-center"},O=o("span",{class:"text-lg"},"用户",-1),q=Object.assign({name:"User"},{__name:"user",setup(q){e("/api/");const J=(e,a)=>{e&&e.forEach((e=>{if(e.children&&e.children.length){const l={authorityId:e.authorityId,authorityName:e.authorityName,children:[]};J(e.children,l.children),a.push(l)}else{const l={authorityId:e.authorityId,authorityName:e.authorityName};a.push(l)}}))},F=e(1),P=e(0),R=e(10),$=e([]),K=e=>{R.value=e,M()},L=e=>{F.value=e,M()},M=async()=>{const e=await n({page:F.value,pageSize:R.value});0===e.code&&($.value=e.data.list,P.value=e.data.total,F.value=e.data.page,R.value=e.data.pageSize)};a((()=>$.value),(()=>{Z()}));(async()=>{M();const e=await _({page:1,pageSize:999});Q(e.data.list)})();const Z=()=>{$.value&&$.value.forEach((e=>{e.authorityIds=e.authorities&&e.authorities.map((e=>e.authorityId))}))};e(null);const G=e([]),Q=e=>{G.value=[],J(e,G.value)},W=e({userName:"",password:"",nickName:"",headerImg:"",authorityId:"",authorityIds:[],enable:1}),X=e({userName:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:5,message:"最低5位字符",trigger:"blur"}],password:[{required:!0,message:"请输入用户密码",trigger:"blur"},{min:6,message:"最低6位字符",trigger:"blur"}],nickName:[{required:!0,message:"请输入用户昵称",trigger:"blur"}],phone:[{pattern:/^1([38][0-9]|4[014-9]|[59][0-35-9]|6[2567]|7[0-8])\d{8}$/,message:"请输入合法手机号",trigger:"blur"}],email:[{pattern:/^([0-9A-Za-z\-_.]+)@([0-9a-z]+\.[a-z]{2,3}(\.[a-z]{2})?)$/g,message:"请输入正确的邮箱",trigger:"blur"}],authorityId:[{required:!0,message:"请选择用户角色",trigger:"blur"}]}),Y=e(null),H=async()=>{W.value.authorityId=W.value.authorityIds[0],Y.value.validate((async e=>{if(e){const e={...W.value};if("add"===le.value){0===(await g(e)).code&&(c({type:"success",message:"创建成功"}),await M(),ae())}if("edit"===le.value){0===(await v(e)).code&&(c({type:"success",message:"编辑成功"}),await M(),ae())}}}))},ee=e(!1),ae=()=>{Y.value.resetFields(),W.value.headerImg="",W.value.authorityIds=[],ee.value=!1},le=e("add"),te=()=>{le.value="add",ee.value=!0},ie={},oe=async(e,a,l)=>{if(console.log(111,e,a),a)return void(l||(ie[e.ID]=[...e.authorityIds]));await h();0===(await y({ID:e.ID,authorityIds:e.authorityIds})).code?c({type:"success",message:"角色设置成功"}):l?e.authorityIds=[l,...e.authorityIds]:(e.authorityIds=[...ie[e.ID]],delete ie[e.ID])};return(e,a)=>{const n=C,g=b,y=A,_=w,q=j,J=k,Z=D,Q=E,ie=f,se=N;return l(),t("div",null,[i(V,{title:"注：右上角头像下拉可切换角色"}),o("div",U,[o("div",z,[i(n,{type:"primary",icon:"plus",onClick:te},{default:s((()=>[r("新增用户")])),_:1})]),i(q,{data:$.value,"row-key":"ID"},{default:s((()=>[i(g,{align:"left",label:"头像","min-width":"75"},{default:s((e=>[i(I,{style:{"margin-top":"8px"},"pic-src":e.row.headerImg},null,8,["pic-src"])])),_:1}),i(g,{align:"left",label:"ID","min-width":"50",prop:"ID"}),i(g,{align:"left",label:"用户名","min-width":"150",prop:"userName"}),i(g,{align:"left",label:"昵称","min-width":"150",prop:"nickName"}),i(g,{align:"left",label:"手机号","min-width":"180",prop:"phone"}),i(g,{align:"left",label:"邮箱","min-width":"180",prop:"email"}),i(g,{align:"left",label:"用户角色","min-width":"200"},{default:s((e=>[i(y,{modelValue:e.row.authorityIds,"onUpdate:modelValue":a=>e.row.authorityIds=a,options:G.value,"show-all-levels":!1,"collapse-tags":"",props:{multiple:!0,checkStrictly:!0,label:"authorityName",value:"authorityId",disabled:"disabled",emitPath:!1},clearable:!1,onVisibleChange:a=>{oe(e.row,a,0)},onRemoveTag:a=>{oe(e.row,!1,a)}},null,8,["modelValue","onUpdate:modelValue","options","onVisibleChange","onRemoveTag"])])),_:1}),i(g,{align:"left",label:"启用","min-width":"150"},{default:s((e=>[i(_,{modelValue:e.row.enable,"onUpdate:modelValue":a=>e.row.enable=a,"inline-prompt":"","active-value":1,"inactive-value":2,onChange:()=>{(async e=>{W.value=JSON.parse(JSON.stringify(e)),await h();const a={...W.value};0===(await v(a)).code&&(c({type:"success",message:"".concat(2===a.enable?"禁用":"启用","成功")}),await M(),W.value.headerImg="",W.value.authorityIds=[])})(e.row)}},null,8,["modelValue","onUpdate:modelValue","onChange"])])),_:1}),i(g,{label:"操作","min-width":"250",fixed:"right"},{default:s((e=>[i(n,{type:"primary",link:"",icon:"delete",onClick:a=>(async e=>{m.confirm("确定要删除吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{0===(await B({id:e.ID})).code&&(c.success("删除成功"),await M())}))})(e.row)},{default:s((()=>[r("删除")])),_:2},1032,["onClick"]),i(n,{type:"primary",link:"",icon:"edit",onClick:a=>{return l=e.row,le.value="edit",W.value=JSON.parse(JSON.stringify(l)),void(ee.value=!0);var l}},{default:s((()=>[r("编辑")])),_:2},1032,["onClick"]),i(n,{type:"primary",link:"",icon:"magic-stick",onClick:a=>{return l=e.row,void m.confirm("是否将此用户密码重置为123456?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{const e=await p({ID:l.ID});0===e.code?c({type:"success",message:e.msg}):c({type:"error",message:e.msg})}));var l}},{default:s((()=>[r("重置密码")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"]),o("div",S,[i(J,{"current-page":F.value,"page-size":R.value,"page-sizes":[10,30,50,100],total:P.value,layout:"total, sizes, prev, pager, next, jumper",onCurrentChange:L,onSizeChange:K},null,8,["current-page","page-size","total"])])]),i(se,{modelValue:ee.value,"onUpdate:modelValue":a[8]||(a[8]=e=>ee.value=e),size:"60%","show-close":!1,"close-on-press-escape":!1,"close-on-click-modal":!1},{header:s((()=>[o("div",T,[O,o("div",null,[i(n,{onClick:ae},{default:s((()=>[r("取 消")])),_:1}),i(n,{type:"primary",onClick:H},{default:s((()=>[r("确 定")])),_:1})])])])),default:s((()=>[i(ie,{ref_key:"userForm",ref:Y,rules:X.value,model:W.value,"label-width":"80px"},{default:s((()=>["add"===le.value?(l(),u(Q,{key:0,label:"用户名",prop:"userName"},{default:s((()=>[i(Z,{modelValue:W.value.userName,"onUpdate:modelValue":a[0]||(a[0]=e=>W.value.userName=e)},null,8,["modelValue"])])),_:1})):d("",!0),"add"===le.value?(l(),u(Q,{key:1,label:"密码",prop:"password"},{default:s((()=>[i(Z,{modelValue:W.value.password,"onUpdate:modelValue":a[1]||(a[1]=e=>W.value.password=e)},null,8,["modelValue"])])),_:1})):d("",!0),i(Q,{label:"昵称",prop:"nickName"},{default:s((()=>[i(Z,{modelValue:W.value.nickName,"onUpdate:modelValue":a[2]||(a[2]=e=>W.value.nickName=e)},null,8,["modelValue"])])),_:1}),i(Q,{label:"手机号",prop:"phone"},{default:s((()=>[i(Z,{modelValue:W.value.phone,"onUpdate:modelValue":a[3]||(a[3]=e=>W.value.phone=e)},null,8,["modelValue"])])),_:1}),i(Q,{label:"邮箱",prop:"email"},{default:s((()=>[i(Z,{modelValue:W.value.email,"onUpdate:modelValue":a[4]||(a[4]=e=>W.value.email=e)},null,8,["modelValue"])])),_:1}),i(Q,{label:"用户角色",prop:"authorityId"},{default:s((()=>[i(y,{modelValue:W.value.authorityIds,"onUpdate:modelValue":a[5]||(a[5]=e=>W.value.authorityIds=e),style:{width:"100%"},options:G.value,"show-all-levels":!1,props:{multiple:!0,checkStrictly:!0,label:"authorityName",value:"authorityId",disabled:"disabled",emitPath:!1},clearable:!1},null,8,["modelValue","options"])])),_:1}),i(Q,{label:"启用",prop:"disabled"},{default:s((()=>[i(_,{modelValue:W.value.enable,"onUpdate:modelValue":a[6]||(a[6]=e=>W.value.enable=e),"inline-prompt":"","active-value":1,"inactive-value":2},null,8,["modelValue"])])),_:1}),i(Q,{label:"头像","label-width":"80px"},{default:s((()=>[i(x,{modelValue:W.value.headerImg,"onUpdate:modelValue":a[7]||(a[7]=e=>W.value.headerImg=e)},null,8,["modelValue"])])),_:1})])),_:1},8,["rules","model"])])),_:1},8,["modelValue"])])}}});export{q as default};
