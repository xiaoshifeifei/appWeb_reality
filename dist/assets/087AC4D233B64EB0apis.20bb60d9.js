/*! 
 Build based on gin-vue-admin 
 Time : 1725432472000 */
import{v as e,a,T as t,o as s,c as o,b as l,d as r,w as i,g as p,t as n,j as d,l as u,E as c}from"./087AC4D233B64EB0index.70d09b05.js";/* empty css                                  */import{E as h}from"./087AC4D233B64EB0tree.2034c53a.js";import"./087AC4D233B64EB0checkbox.946614c0.js";/* empty css                                *//* empty css                               *//* empty css                               *//* empty css                              */import{j as m}from"./087AC4D233B64EB0api.081d701a.js";import{E as f}from"./087AC4D233B64EB0index.c39333f3.js";import{E as B}from"./087AC4D233B64EB0index.86c76e0e.js";import"./087AC4D233B64EB0token.9ae252be.js";import"./087AC4D233B64EB0index.8862a37e.js";import"./087AC4D233B64EB0isEqual.754d772a.js";import"./087AC4D233B64EB0_Uint8Array.b8c6af2c.js";import"./087AC4D233B64EB0index.a54c8ec8.js";const v={class:"sticky top-0.5 z-10 flex space-x-2"},j={class:"tree-content"},y={class:"flex items-center justify-between w-full pr-1"},E={class:"max-w-[240px] break-all overflow-ellipsis overflow-hidden"},C=Object.assign({name:"Apis"},{__name:"apis",props:{row:{default:function(){return{}},type:Object}},setup(C,{expose:A}){const x=C,D=a({children:"children",label:"description"}),b=a(""),w=a(""),k=a([]),g=a([]),I=a("");(async()=>{const a=(await m()).data.apis;k.value=O(a);const t=await(s={authorityId:x.row.authorityId},e({url:"/casbin/getPolicyPathByAuthorityId",method:"post",data:s}));var s;I.value=x.row.authorityId,g.value=[],t.data.paths&&t.data.paths.forEach((e=>{g.value.push("p:"+e.path+"m:"+e.method)}))})();const _=a(!1),V=()=>{_.value=!0},O=e=>{const a={};e&&e.forEach((e=>{e.onlyId="p:"+e.path+"m:"+e.method,Object.prototype.hasOwnProperty.call(a,e.apiGroup)?a[e.apiGroup].push(e):Object.assign(a,{[e.apiGroup]:[e]})}));const t=[];for(const s in a){const e={ID:s,description:s+"组",children:a[s]};t.push(e)}return t},G=a(null),P=async()=>{const a=G.value.getCheckedNodes(!0);var t=[];a&&a.forEach((e=>{var a={path:e.path,method:e.method};t.push(a)}));var s;0===(await(s={authorityId:I.value,casbinInfos:t},e({url:"/casbin/updateCasbin",method:"post",data:s}))).code&&d({type:"success",message:"api设置成功"})};A({needConfirm:_,enterAndNext:()=>{P()}});const U=(e,a)=>{if(!b.value&&!w.value)return!0;let t,s;return t=!b.value||a.description&&a.description.includes(b.value),s=!w.value||a.path&&a.path.includes(w.value),t&&s};return t([b,w],(()=>{G.value.filter("")})),(e,a)=>{const t=u,d=c,m=f,C=h,A=B;return s(),o("div",null,[l("div",v,[r(t,{modelValue:b.value,"onUpdate:modelValue":a[0]||(a[0]=e=>b.value=e),class:"flex-1",placeholder:"筛选名字"},null,8,["modelValue"]),r(t,{modelValue:w.value,"onUpdate:modelValue":a[1]||(a[1]=e=>w.value=e),class:"flex-1",placeholder:"筛选路径"},null,8,["modelValue"]),r(d,{class:"float-right",type:"primary",onClick:P},{default:i((()=>[p("确 定")])),_:1})]),l("div",j,[r(A,null,{default:i((()=>[r(C,{ref_key:"apiTree",ref:G,data:k.value,"default-checked-keys":g.value,props:D.value,"default-expand-all":"","highlight-current":"","node-key":"onlyId","show-checkbox":"","filter-node-method":U,onCheck:V},{default:i((({node:e,data:a})=>[l("div",y,[l("span",null,n(a.description),1),r(m,{content:a.path},{default:i((()=>[l("span",E,n(a.path),1)])),_:2},1032,["content"])])])),_:1},8,["data","default-checked-keys","props"])])),_:1})])])}}});export{C as default};
